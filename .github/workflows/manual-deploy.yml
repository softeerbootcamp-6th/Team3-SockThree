name: Manual Deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'ë°°í¬í•  í™˜ê²½ì„ ì„ íƒí•˜ì„¸ìš”'
        required: true
        default: 'development'
        type: choice
        options:
        - development
        - staging
        - production
      image_tag:
        description: 'ë°°í¬í•  ì´ë¯¸ì§€ íƒœê·¸ (ê¸°ë³¸: latest)'
        required: false
        default: 'latest'

env:
  REGISTRY: ghcr.io
  BACKEND_IMAGE_NAME: ${{ github.repository }}/backend

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Deploy Backend
      run: |
        echo "ğŸš€ Backend ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
        echo "í™˜ê²½: ${{ inputs.environment }}"
        echo "ì´ë¯¸ì§€: ${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE_NAME }}:${{ inputs.image_tag }}"

        # TODO: ì‹¤ì œ ë°°í¬ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ:
        # - SSHë¡œ ì„œë²„ ì ‘ì†
        # - Docker Compose ì—…ë°ì´íŠ¸
        # - ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
        # - í—¬ìŠ¤ì²´í¬

        echo "âœ… Backend ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"

  notify:
    runs-on: ubuntu-latest
    needs: [deploy-backend]
    if: always()

    steps:
    - name: Notify deployment result
      run: |
        echo "ğŸ“‹ ë°°í¬ ê²°ê³¼ ì•Œë¦¼"
        echo "í™˜ê²½: ${{ inputs.environment }}"
        echo "ì„œë¹„ìŠ¤: backend"
        echo "ì´ë¯¸ì§€ íƒœê·¸: ${{ inputs.image_tag }}"

        # TODO: ì‹¤ì œ ì•Œë¦¼ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ:
        # - Slack ì•Œë¦¼
        # - Discord ì•Œë¦¼
        # - ì´ë©”ì¼ ì•Œë¦¼
