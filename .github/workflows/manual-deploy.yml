name: Manual Deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'ë°°í¬í•  í™˜ê²½ì„ ì„ íƒí•˜ì„¸ìš”'
        required: true
        default: 'development'
        type: choice
        options:
        - development
        - staging
        - production
      service:
        description: 'ë°°í¬í•  ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - backend
        - frontend
      image_tag:
        description: 'ë°°í¬í•  ì´ë¯¸ì§€ íƒœê·¸ (ê¸°ë³¸: latest)'
        required: false
        default: 'latest'

env:
  REGISTRY: ghcr.io
  BACKEND_IMAGE_NAME: ${{ github.repository }}/backend
  FRONTEND_IMAGE_NAME: ${{ github.repository }}/frontend

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    if: ${{ inputs.service == 'all' || inputs.service == 'backend' }}
    environment: ${{ inputs.environment }}
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Deploy Backend
      run: |
        echo "ğŸš€ Backend ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
        echo "í™˜ê²½: ${{ inputs.environment }}"
        echo "ì´ë¯¸ì§€: ${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE_NAME }}:${{ inputs.image_tag }}"
        
        # TODO: ì‹¤ì œ ë°°í¬ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ:
        # - SSHë¡œ ì„œë²„ ì ‘ì†
        # - Docker Compose ì—…ë°ì´íŠ¸
        # - ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
        # - í—¬ìŠ¤ì²´í¬
        
        echo "âœ… Backend ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"

  deploy-frontend:
    runs-on: ubuntu-latest
    if: ${{ inputs.service == 'all' || inputs.service == 'frontend' }}
    environment: ${{ inputs.environment }}
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Deploy Frontend
      run: |
        echo "ğŸš€ Frontend ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
        echo "í™˜ê²½: ${{ inputs.environment }}"
        echo "ì´ë¯¸ì§€: ${{ env.REGISTRY }}/${{ env.FRONTEND_IMAGE_NAME }}:${{ inputs.image_tag }}"
        
        # TODO: ì‹¤ì œ ë°°í¬ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ:
        # - S3ì— ì •ì  íŒŒì¼ ì—…ë¡œë“œ
        # - CloudFront ìºì‹œ ë¬´íš¨í™”
        # ë˜ëŠ”
        # - Docker ì»¨í…Œì´ë„ˆ ë°°í¬
        
        echo "âœ… Frontend ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"

  notify:
    runs-on: ubuntu-latest
    needs: [deploy-backend, deploy-frontend]
    if: always()
    
    steps:
    - name: Notify deployment result
      run: |
        echo "ğŸ“‹ ë°°í¬ ê²°ê³¼ ì•Œë¦¼"
        echo "í™˜ê²½: ${{ inputs.environment }}"
        echo "ì„œë¹„ìŠ¤: ${{ inputs.service }}"
        echo "ì´ë¯¸ì§€ íƒœê·¸: ${{ inputs.image_tag }}"
        
        # TODO: ì‹¤ì œ ì•Œë¦¼ ë¡œì§ êµ¬í˜„
        # ì˜ˆì‹œ:
        # - Slack ì•Œë¦¼
        # - Discord ì•Œë¦¼
        # - ì´ë©”ì¼ ì•Œë¦¼
